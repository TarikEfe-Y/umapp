<!DOCTYPE html>
<html>
<head>
    <title>Firebase uMap</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <script>
        // Firebase Konfigürasyonu
        const firebaseConfig = {
            apiKey: "AIzaSyC35m5nbt3el3FNfKdwCBGm9Sgq_jPg0eQ",
            authDomain: "navigasyon-ffc0c.firebaseapp.com",
            databaseURL: "https://navigasyon-ffc0c-default-rtdb.firebaseio.com",
            projectId: "navigasyon-ffc0c",
            storageBucket: "navigasyon-ffc0c.firebasestorage.app",
            messagingSenderId: "361693401199",
            appId: "1:361693401199:web:57acf604aa2458f4e13d9a"
        };
        
        // Firebase Başlat
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Leaflet Haritasını Başlat
        const map = L.map('map').setView([39.9334, 32.8597], 6); // Ankara merkez
        
        // OpenStreetMap Katmanı
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        let markers = [];
        
        // Firebase'den Verileri Dinle
        database.ref("locations").on("value", (snapshot) => {
            const data = snapshot.val();
            if (!data) return;

            // Mevcut markerları temizle
            clearMarkers();

            // Yeni markerları ekle
            Object.keys(data).forEach((key) => {
                const location = data[key];
                addMarker(location.latitude, location.longitude, location.type);
            });
        });
        
        // Marker ekleme fonksiyonu
        function addMarker(lat, lng, type) {
            const color = type === "erzak" ? "red" : "blue"; // Erzak = Kırmızı, Malzeme = Mavi
            const marker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="width:20px; height:20px; background:${color}; border-radius:50%;"></div>`
                })
            }).addTo(map)
            .bindPopup(`<b>${type.toUpperCase()}</b><br>Lat: ${lat}, Lng: ${lng}`);
            
            markers.push(marker);
        }
        
        // Haritadaki tüm markerları temizle
        function clearMarkers() {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
        }
    </script>
</body>
</html>
