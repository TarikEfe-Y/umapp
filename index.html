<!DOCTYPE html>
<html>
<head>
    <title>OpenStreetMap Firebase Marker</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
    <style>
        #map { height: 500px; }
    </style>
</head>
<body>

    <h1>OpenStreetMap Firebase Marker</h1>
    <div id="map"></div>

    <script>
        // 📌 Firebase konfigürasyonunu buraya ekle
        const firebaseConfig = {
            apiKey: "AIzaSyC35m5nbt3el3FNfKdwCBGm9Sgq_jPg0eQ",
            authDomain: "navigasyon-ffc0c.firebaseapp.com",
            databaseURL: "https://navigasyon-ffc0c-default-rtdb.firebaseio.com",
            projectId: "navigasyon-ffc0c",
            storageBucket: "navigasyon-ffc0c.firebasestorage.app",
            messagingSenderId: "361693401199",
            appId: "1:361693401199:web:57acf604aa2458f4e13d9a"
        };

        // Firebase'i başlat
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Haritayı başlat
        var map = L.map("map").setView([39.92, 32.85], 13); // Ankara merkez alındı

        // OpenStreetMap katmanı ekle
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

        // 🔴 Firebase'den verileri çekip haritaya marker ekleme fonksiyonu
        function fetchLocations() {
            database.ref("locations").once("value", function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    var data = childSnapshot.val();
                    var lat = data.latitude;
                    var lon = data.longitude;
                    
                    // Firebase'deki her konum için haritaya marker ekle
                    L.marker([lat, lon]).addTo(map)
                      .bindPopup("Latitude: " + lat + "<br>Longitude: " + lon);
                });
            });
        }

        // 📌 Firebase'deki konumları anlık olarak dinle (SAYFA YENİLEMEDEN!)
        database.ref("locations").on("child_added", function(snapshot) {
            var data = snapshot.val();
            L.marker([data.latitude, data.longitude]).addTo(map)
              .bindPopup("Latitude: " + data.latitude + "<br>Longitude: " + data.longitude);
        });

        // 📍 Haritaya tıklayınca Firebase'e yeni marker ekleme
        map.on("click", function (e) {
            var latitude = e.latlng.lat;
            var longitude = e.latlng.lng;

            // Firebase'e yeni konum ekle
            database.ref("locations").push({
                latitude: latitude,
                longitude: longitude
            });
        });

        // Sayfa açıldığında mevcut konumları çek
        fetchLocations();
    </script>

</body>
</html>
